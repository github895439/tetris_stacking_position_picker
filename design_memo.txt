動画を読み込む。

次ミノ位置設定。

フィールド位置設定。

プレイ開始判定場所設定
開始時の「READY」の「R」の丸の左辺りで判定する。
ピクセル単位だと微妙に色が違うため、輝度を取得して0.95以上で判定する。

繰り返し

　プレイ開始判定
　ゲームオーバーになるミノは意味がないので、これが真になったら置き後取得の無い置き前取得を破棄する。

　状態
　　置き前取得

　　次ミノが変わる、または、消しが発生したら前フレームで置き後取得　
　　次ミノが変わるは、NEXTミノの上から1マス目、左から2マス目のマスの真ん中辺りの変化で判定する。
　　消しは、ラインが消えているかだが、ラインの全マスの色が変化したか。
　　変化は、１マスの最上部より少し下で、左右端の少し内側の２点のどちらかが変化したか。

　置き前と置き後でログ作成
　何をどこに置いたかなので、１情報で表せる。
　何をは次ミノの色を使う。
　どこには、下記で、1クレジットごとのログファイルに追記していく。
　(黒が置いたもの。)
　どういう操作で置いたかは動画で確認するため、その手掛かりとしてフレーム数から逆算したタイムスタンプ(精度は秒くらい)を付ける。
　ファイル名はタイムスタンプとかがわかりやすい。

00:01:23
┌──────────┐
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　　　　　　　　　│
│　　□■　　　　　　│
│□□□■■■　　　　│
└──────────┘
(githubだと崩れている。
全て全角文字だと崩れない。)

■追記
動画ファイル名に🄬が含まれると誤動作する。(IsOpenedメソッドがずっとfalseでReadしたものを使えない。)
フレームマージがあるため、プレイ終了も検出する必要がある。
プレイ終了は、「OVER」の「O」と「R」でプレイ開始時のように輝度で判定する。
(「GAME」ではないのは開始の位置と同じで誤判定してしまうため。)
フィールド状態取得のために、フィールド位置判定設定が必要なので、フィールドの左上と右下を設定させ、その中を10x20分割して取得する。
フィールドとNEXTでは輝度が2.5倍近く違う。
具体的には、RGB値が2.5倍ということ。
(ただ、ミノ=色によって違うかもしれない。)
フィールドの1.9～2.5倍の輝度をNEXTの閾値にするが、RGB値が0等小さい値の場合に閾値が狭すぎる。
最大値が20未満の時は、0～20の矯正値にする。
フィールドのマス有無判定は輝度0.1未満かどうかで判定する。
各マスの指定は1マスを元にした積み上げだと誤差で誤動作するので、全長を元にした百分率にする。
NEXTを色で判断することはできない。
(揺らぎのために実際にはかなりの色の幅がある。
更に、そもそもの考え方として、明るさの範囲とした場合は、RGB値それぞれ同値での範囲ではない。
例えば、R:100、:G:200、B:0という色があるとする。
この輝度が半分になるということは、R:50、G:100、B:0になるということで、値差でいえば、Rは50減だがBは100減であるから。)
幸い表示処理中は常に横縞になるようなので、設定座標とその上の点で、明るい方を使って判断する。
何色かではなく、どのマスに色がついているかでNEXTが何かを判断する。
マージの時は7パターンと一致しないためわかる。
ただ、同ミノ連続を検出できない。

■問題点
1
元情報がアナログ情報なため、正確には揺らぎがある。
例えば、フレーム合成の無いNEXTでも、人目では同じ色だが、データ上は微妙に色が変わっていたりする。
このため、色によってNEXTがどのミノかを特定するのは難しい。

2
動画であるため、フレームマージがあり、人目の処理は通用しない。
例えば、NEXTが変わる場合、前と後のミノが1フレームに表示されていたり、フィールド上に1操作の前後の2ミノ分が1フレームに表示されていたりする。
問題点1の回避として、マスの点灯の変化でミノを特定しようとしても、ありえないミノが検出されてしまう。
また、同じミノが連続する場合もあるため、変化ではその場合が漏れてしまう。

3
ライン消えは演出があり、その演出をマス点灯と誤認識してしまう場合があるため、正確に積みと消えを区別するのは難しい。

回避に下記の3つを試した。
1　NEXTを色で判別
2　NEXTを明るさで判別
3　NEXTを使わず、フィールドの変化で判別
しかし、どれも不十分のため、結局、下記の問題を持つ2番目の方法にした。
1　同ミノ連続は判別できないため、同時に2ミノが落ちてきたような解釈になってしまう
2　ライン消しが起きる場合は、フィールドを正確に判別できない上に、その影響でその後も少し判別できない

■改良
対戦モードの場合は、開始時に左右フィールドの間に表示される「GO」を開始判断にすると良さそう。
終了は左右フィールド内に表示される「WIN」と「LOSE」を終了判断にすると良さそう。

[シーケンス(ライン消し無し)]
　１　落ち前フィールド
　　マージフレームかNEXT更新の直近フレーム
　２　(フレームマージ)
　３　NEXT更新
　　　　フィールドには今のミノが表示される

[シーケンス(ライン消し有り)]
　１　落ち前フィールド
　　マージフレームかNEXT更新の直近フレーム
　２　(フレームマージ)
　３　NEXT更新
　　　　フィールドには今のミノが表示される
　４　(操作)
　５　ライン消え
　６　ライン落ち
　７　(フレームマージ)
　８　NEXT更新
　　　　フィールドには今のミノが表示される
